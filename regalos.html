<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Regalos ğŸ¤</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body style="display:flex; justify-content:center; padding:40px 0;">
  <div class="contenedor">

    <h1>Regalos ğŸ¤</h1>
    <p class="descripcion">
      AquÃ­ puedes escribir las cosas que te ilusionan.
      Algunas llegarÃ¡n prontoâ€¦ otras con el tiempo.
    </p>

    <!-- ğŸ€ DETALLES -->
    <section>
      <h2>ğŸ€ Detalles pequeÃ±os</h2>

      <div class="input-grupo">
        <input type="text" id="input-detalle" placeholder="Escribe un detalleâ€¦" />
        <button onclick="agregarRegalo('detalle')">Agregar</button>
      </div>

      <ul id="lista-detalle"></ul>
    </section>

    <!-- âœ¨ EXPERIENCIAS -->
    <section>
      <h2>âœ¨ Experiencias</h2>

      <div class="input-grupo">
        <input type="text" id="input-experiencia" placeholder="Escribe una experienciaâ€¦" />
        <button onclick="agregarRegalo('experiencia')">Agregar</button>
      </div>

      <ul id="lista-experiencia"></ul>
    </section>

    <!-- ğŸŒ™ SUEÃ‘OS -->
    <section>
      <h2>ğŸŒ™ SueÃ±os grandes</h2>

      <div class="input-grupo">
        <input type="text" id="input-sueno" placeholder="Escribe un sueÃ±oâ€¦" />
        <button onclick="agregarRegalo('sueno')">Agregar</button>
      </div>

      <ul id="lista-sueno"></ul>
    </section>

    <a href="index.html" class="boton-diario" style="margin-top:40px;">
      Volver ğŸ¤
    </a>

  </div>

  <script>
    const SUPABASE_URL = "TU_SUPABASE_URL";
    const SUPABASE_KEY = "TU_SUPABASE_KEY";

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function agregarRegalo(categoria) {
      const input = document.getElementById(`input-${categoria}`);
      const texto = input.value.trim();

      if (!texto) {
        alert("Escribe algo primero ğŸ¤");
        return;
      }

      const { error } = await sb.from("regalos").insert([{
        contenido: texto,
        categoria: categoria,
        cumplido: false
      }]);

      if (error) {
        console.error(error);
        alert("Algo pasÃ³, pero lo intentamos juntos ğŸ¤");
      } else {
        input.value = "";
        cargarRegalos();
      }
    }

    async function cargarRegalos() {
      const { data, error } = await sb
        .from("regalos")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error(error);
        return;
      }

      ["detalle", "experiencia", "sueno"].forEach(cat => {
        document.getElementById(`lista-${cat}`).innerHTML = "";
      });

      data.forEach(regalo => {
        const li = document.createElement("li");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = regalo.cumplido;

        checkbox.onchange = () => marcarCumplido(regalo.id, checkbox.checked);

        const texto = document.createElement("span");
        texto.textContent = regalo.contenido;

        if (regalo.cumplido) {
          texto.classList.add("regalo-cumplido");
        }

        li.appendChild(checkbox);
        li.appendChild(texto);

        document
          .getElementById(`lista-${regalo.categoria}`)
          .appendChild(li);
      });
    }

    async function marcarCumplido(id, estado) {
      await sb
        .from("regalos")
        .update({ cumplido: estado })
        .eq("id", id);

      cargarRegalos();
    }

    cargarRegalos();
  </script>
</body>
</html>
