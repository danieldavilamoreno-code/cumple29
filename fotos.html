<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Fotos ü§ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="fotos-page">
  <div class="page-scroll">
  <div class="contenedor">
    <h1>üì∏ Tus recuerdos m√°s valiosos</h1>
    <p class="descripcion">
      Guarda aqu√≠ los momentos que m√°s valoras‚Ä¶ prometo cuidarlos ü§ç
    </p>

    <!-- AMIGOS -->
    <div class="bloque">
      <h2>Amigos</h2>
      <input type="file" id="file-amigos" accept="image/*"multiple>
      <button class="btn-subir" onclick="enviarFoto('amigos')">Enviar foto</button>
      <div class="galeria" id="galeria-amigos"></div>
    </div>

    <!-- FAMILIA -->
    <div class="bloque">
      <h2>Familia</h2>
      <input type="file" id="file-familia" accept="image/*"multiple>
      <button class="btn-subir" onclick="enviarFoto('familia')">Enviar foto</button>
      <div class="galeria" id="galeria-familia"></div>
    </div>

    <!-- ELLA -->
    <div class="bloque">
      <h2>Liz</h2>
      <input type="file" id="file-liz" accept="image/*"multiple>
      <button class="btn-subir" onclick="enviarFoto('liz')">Enviar foto</button>
      <div class="galeria" id="galeria-liz"></div>
    </div>

    <!-- NOSOTROS -->
    <div class="bloque">
      <h2>Nosotros</h2>
      <input type="file" id="file-nosotros" accept="image/*"multiple>
      <button class="btn-subir" onclick="enviarFoto('nosotros')">Enviar foto</button>
      <div class="galeria" id="galeria-nosotros"></div>
    </div>

     <a href="index.html" class="boton-diario" style="margin-top:40px;">
      Volver ü§ç
    </a>
  </div>

  <script>
    /* ==============================
       üîê SUPABASE CONFIGURACI√ìN
       ============================== */

    const SUPABASE_URL = "https://vunamqmjquqqbjcuewfp.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1bmFtcW1qcXVxcWJqY3Vld2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNjAzMDksImV4cCI6MjA4MzYzNjMwOX0.Az5YzL_lMnaxjaR-o399mLeOctRincjK-SJGV9yHoOA";
const sb = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);


    /* ==============================
       üì§ SUBIR FOTO
       ============================== */

  async function enviarFoto(categoria) {
  const input = document.getElementById(`file-${categoria}`);
  const archivos = input.files;

  if (!archivos || archivos.length === 0) {
    alert("Selecciona al menos una foto ü§ç");
    return;
  }

  for (let archivo of archivos) {
    const nombreArchivo = `${categoria}/${Date.now()}-${archivo.name}`;

    const { error } = await sb
      .storage
      .from("fotos")
      .upload(nombreArchivo, archivo);

    if (error) {
      console.error(error);
      alert("Hubo un problema subiendo una foto üíî");
      return;
    }
  }

  input.value = "";
  alert("Recuerdos subidos, los cuidar√© con el coraz√≥n ü§ç");

  // Recarga la galer√≠a de esa categor√≠a
  cargarFotos(categoria);
}


    /* ==============================
       üñºÔ∏è CARGAR FOTOS
       ============================== */

    async function cargarFotos(categoria) {
      const contenedor = document.getElementById(`galeria-${categoria}`);
      contenedor.innerHTML = "";

      const { data, error } = await sb.storage
        .from("fotos")
        .list(categoria, { limit: 50 });

      if (error) {
        console.error(error);
        return;
      }

      for (const file of data) {
        const { data: url } = sb.storage
          .from("fotos")
          .getPublicUrl(`${categoria}/${file.name}`);

        const img = document.createElement("img");
        img.src = url.publicUrl;
        contenedor.appendChild(img);
      }
    }

    /* ==============================
       üîÑ CARGA INICIAL
       ============================== */

    ["amigos", "familia", "liz", "nosotros"].forEach(cargarFotos);
  </script>

</body>
</html>
