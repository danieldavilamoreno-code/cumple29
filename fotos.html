<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Fotos ü§ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

  <div class="contenedor">
    <h1>üì∏ Nuestros recuerdos</h1>
    <p class="descripcion">
      Guarda aqu√≠ los momentos que m√°s valoras‚Ä¶ prometo cuidarlos ü§ç
    </p>

    <!-- AMIGOS -->
    <div class="bloque">
      <h2>Amigos</h2>
      <input type="file" id="file-amigos" accept="image/*">
      <button class="btn-subir" onclick="enviarFoto('amigos')">Enviar foto</button>
      <div class="galeria" id="galeria-amigos"></div>
    </div>

    <!-- FAMILIA -->
    <div class="bloque">
      <h2>Familia</h2>
      <input type="file" id="file-familia" accept="image/*">
      <button class="btn-subir" onclick="enviarFoto('familia')">Enviar foto</button>
      <div class="galeria" id="galeria-familia"></div>
    </div>

    <!-- ELLA -->
    <div class="bloque">
      <h2>Liz</h2>
      <input type="file" id="file-liz" accept="image/*">
      <button class="btn-subir" onclick="enviarFoto('liz')">Enviar foto</button>
      <div class="galeria" id="galeria-liz"></div>
    </div>

    <!-- NOSOTROS -->
    <div class="bloque">
      <h2>Nosotros</h2>
      <input type="file" id="file-nosotros" accept="image/*">
      <button class="btn-subir" onclick="enviarFoto('nosotros')">Enviar foto</button>
      <div class="galeria" id="galeria-nosotros"></div>
    </div>

    <a href="index.html" class="volver">‚Üê Volver</a>
  </div>

  <script>
    // üîê CONFIGURA AQU√ç TUS DATOS DE SUPABASE
    const SUPABASE_URL = "TU_SUPABASE_URL";
    const SUPABASE_KEY = "TU_SUPABASE_PUBLIC_KEY";

    const supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_KEY
    );

    // üì§ SUBIR FOTO
    async function enviarFoto(categoria) {
      const input = document.getElementById(`file-${categoria}`);
      const file = input.files[0];

      if (!file) {
        alert("Primero selecciona una foto ü§ç");
        return;
      }

      const nombre = `${Date.now()}-${file.name}`;

      const { error } = await supabase.storage
        .from("fotos")
        .upload(`${categoria}/${nombre}`, file);

      if (error) {
        console.error(error);
        alert("No se pudo subir la foto ü§ç");
        return;
      }

      alert("Recuerdo subido, los cuidar√© con el coraz√≥n ü§ç");
      input.value = "";
      cargarFotos(categoria);
    }

    // üñºÔ∏è CARGAR FOTOS
    async function cargarFotos(categoria) {
      const contenedor = document.getElementById(`galeria-${categoria}`);
      contenedor.innerHTML = "";

      const { data, error } = await supabase.storage
        .from("fotos")
        .list(categoria, { limit: 50, sortBy: { column: "created_at", order: "desc" } });

      if (error) {
        console.error(error);
        return;
      }

      for (const file of data) {
        const { data: url } = supabase.storage
          .from("fotos")
          .getPublicUrl(`${categoria}/${file.name}`);

        const img = document.createElement("img");
        img.src = url.publicUrl;
        contenedor.appendChild(img);
      }
    }

    // üîÑ CARGA INICIAL
    ["amigos", "familia", "liz", "nosotros"].forEach(cargarFotos);
  </script>

</body>
</html>
