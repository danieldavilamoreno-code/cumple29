<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Un recuerdo para ella ü§ç</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="fondo">
    <div class="contenedor">

      <h1>Un recuerdo para ella ü§ç</h1>

      <p class="descripcion">
        Si est√°s aqu√≠ es porque has sido parte de su historia.
      </p>

      <p class="descripcion">
        Este espacio es solo para guardar un recuerdo bonito con ella.
        Nada se publica, nada se comparte.
        Yo me encargar√© de cuidarlo con cari√±o.
      </p>

      <p class="descripcion">
        Puedes subir una foto y, si quieres, escribir unas palabras.
        No tiene que ser perfecto. Solo sincero.
      </p>

      <!-- FORMULARIO -->
      <div class="bloque-formulario">

        <input type="file" id="foto" accept="image/*">

        <textarea
          id="mensaje"
          rows="4"
          placeholder="Si quieres, escribe aqu√≠ unas palabras‚Ä¶"
        ></textarea>

        <button type="button" onclick="subirFoto()">Enviar recuerdo</button>

      </div>

      <!-- MENSAJE FINAL -->
      <p class="nota">
        Tu recuerdo a√∫n no ha sido enviado.
      </p>

    </div>
  </div>

  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // üîê CONFIGURACI√ìN SUPABASE
    const supabaseUrl = "https://vunamqmjquqqbjcuewfp.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1bmFtcW1qcXVxcWJqY3Vld2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNjAzMDksImV4cCI6MjA4MzYzNjMwOX0.Az5YzL_lMnaxjaR-o399mLeOctRincjK-SJGV9yHoOA";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // üì§ FUNCI√ìN DE SUBIDA
    window.subirFoto = async function () {
      const archivo = document.getElementById("foto").files[0];
      const texto = document.getElementById("mensaje").value;
      const nota = document.querySelector(".nota");

      if (!archivo) {
        alert("Por favor, elige una foto ü§ç");
        return;
      }

      const nombreArchivo = `amigo-${Date.now()}-${archivo.name}`;

      const { error } = await supabaseClient.storage
        .from("fotos-amigos")
        .upload(nombreArchivo, archivo, {
          metadata: {
            mensaje: texto
          }
        });

      if (error) {
        console.error(error);
        alert("Ocurri√≥ un error al guardar el recuerdo üò¢");
      } else {
        // LIMPIAR FORMULARIO
        document.getElementById("foto").value = "";
        document.getElementById("mensaje").value = "";

        // MENSAJE FINAL
        nota.innerText =
          "Gracias ü§ç Tu recuerdo fue recibido y ser√° cuidado con mucho cari√±o.";
      }
    };
  </script>

</body>
</html>
