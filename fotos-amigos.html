<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Un recuerdo para Liz ü§ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-scroll">
  <div class="fondo">
    <div class="contenedor">

      <h1>Un recuerdo para Liz ü§ç</h1>

      <p class="descripcion">
        Si est√°s aqu√≠ es porque has sido parte de mi historia.
      </p>

      <p class="descripcion">
        Este espacio es solo para guardar un recuerdo bonito conmigo.
        Nada se publica, nada se comparte.
        Yo me encargar√© de cuidarlo con mucho cari√±o.
      </p>

      <p class="descripcion">
        Puedes subir una foto y, si quieres, escribir unas palabras.
        No tiene que ser perfecto. Solo sincero.
      </p>

      <!-- FORMULARIO -->
      <div class="bloque-formulario">

        <input type="file" id="foto" accept="image/*">

        <input
          type="text"
          id="autor"
          placeholder="Tu nombre (opcional)"
        >

        <textarea
          id="mensaje"
          rows="4"
          placeholder="Si quieres, escribe aqu√≠ unas palabras‚Ä¶"
        ></textarea>

        <button type="button" onclick="subirFoto()">Enviar recuerdo</button>

      </div>

      <!-- MENSAJE FINAL -->
      <p class="nota">
        Tu recuerdo a√∫n no ha sido enviado.
      </p>

    </div>
  </div>

  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // üîê CONFIGURACI√ìN SUPABASE
    const SUPABASE_URL = "https://vunamqmjquqqbjcuewfp.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1bmFtcW1qcXVxcWJqY3Vld2ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNjAzMDksImV4cCI6MjA4MzYzNjMwOX0.Az5YzL_lMnaxjaR-o399mLeOctRincjK-SJGV9yHoOA";

    const supabaseClient = supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );

    // üì§ FUNCI√ìN PRINCIPAL
    window.subirFoto = async function () {
      const archivo = document.getElementById("foto").files[0];
      const texto = document.getElementById("mensaje").value;
      const autor = document.getElementById("autor").value;
      const nota = document.querySelector(".nota");

      if (!archivo) {
        alert("Por favor, elige una foto ü§ç");
        return;
      }

      const nombreArchivo = `amigo-${Date.now()}-${archivo.name}`;

      // 1Ô∏è‚É£ SUBIR FOTO
      const { error: errorFoto } = await supabaseClient.storage
        .from("fotos-amigos")
        .upload(nombreArchivo, archivo);

      if (errorFoto) {
        console.error(errorFoto);
        alert("Ocurri√≥ un error al guardar la foto üò¢");
        return;
      }

      // 2Ô∏è‚É£ GUARDAR EN TABLA
      const { error: errorInsert } = await supabaseClient
        .from("recuerdos-amigos")
        .insert([
          {
            foto_nombre: nombreArchivo,
            mensaje: texto,
            autor: autor,
            categoria: "amigos"
          }
        ]);

      if (errorInsert) {
        console.error("Error guardando en tabla:", errorInsert);
        alert("La foto se guard√≥, pero el mensaje no üò¢");
        return;
      }

      // 3Ô∏è‚É£ √âXITO TOTAL ü§ç
      document.getElementById("foto").value = "";
      document.getElementById("mensaje").value = "";
      document.getElementById("autor").value = "";

      nota.innerText =
        "Gracias ü§ç fue recibido con √©xito, ser√° un d√≠a especial.";

      alert("Gracias ü§ç fue recibido con √©xito, ser√° un d√≠a especial");
    };
  </script>

</body>
</html>
